<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>preloadResource test</title>
    <style type="text/css">
      body { font-family: monospace; }
    </style>
    <script type="text/javascript">
      /*! Based on the version by Stoyan Stefanov, but with added timeout capability */
      function preloadResource(resourceUrl, callback, timeout) {
        
        var shouldUseImage = /*@cc_on!@*/0 || 
                              (typeof window.opera !== 'undefined' && 
                              ({}).toString.call(window.opera) === '[object Opera]'),
            el, 
            loaded = false;
        
        function onLoad() {
          if (!loaded) {
            loaded = true;
            timeoutId = null;
            callback('loaded');
          }
        }
        
        var timeoutId = setTimeout(function() {
          if (!loaded) {
            loaded = true;
            callback('timed out');
          }
        }, timeout);

        if (shouldUseImage) {
          el = new Image();
          el.onload = el.onerror = onLoad;
          el.src = resourceUrl;
          el = null;
        }
        else {
          el = document.createElement('object');
          el.onload = onLoad;
          el.data = resourceUrl;
          el.style.display = 'none';
          
          document.body.appendChild(el);
          // document.documentElement.insertBefore(el, document.documentElement.firstChild);
        }  
      };
      
      var id = 999;
      function load() {
        var resourceDelay = parseInt(document.getElementById('resourceDelay').value, 10),
            resourceTimeout = parseInt(document.getElementById('resourceTimeout').value, 10);
        
        var url = 'http://1.cuzillion.com/bin/resource.cgi?type=js&sleep=' + (resourceDelay / 1000) + '&n=1&t=' + Number(new Date());
        preloadResource(url, function(status) {
          alert(status);
        }, resourceTimeout);
      }
    </script>
  </head>
  <body>
    <div>
      <h1>Testing <code>preloadResource</code> with callback/timeout capabilities</h1>
      <label for="resourceDelay">Resource delay:</label>
      <input value="2000" id="resourceDelay">

      <label for="resourceTimeout">Resource timeout:</label>
      <input value="1000" id="resourceTimeout">

      <input type="submit" onclick="load();" value="Load resource">
      
      <div>
        <p>Successfully tested browsers: <sup style="color:red">*</sup></p>
        <ul>
          <li>Safari 5, 4.0.5, 3.2.1, 3.1.2, 3.0.4</li>
          <li>Opera 10.60, 10.50, 10.10, 9.64, 9.50</li>
          <li>Firefox 3.6, 3.5, 3.0</li>
          <li>Chrome 5</li>
          <li>Internet Explorer 8, 7, 6, 5.5</li>
        </ul>
        <sup style="color:red">*</sup> 
          <span style="color:#888;font-style:italic;font-size:0.85em">
            where "successful" means that load/error event fires when loading resource, and that timeout callback works as expected.</span>
        <p>Known failures:</p>
        <ul>
          <li>Firefox 1.x, 1.5.x, and 2.x — load event on OBJECT element never fires</li>
          <li>Safari 2.0.4 — load event on OBJECT element never fires</li>
        </ul>
      </div>
    </div>
  </body>
</html>