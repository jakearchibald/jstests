<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title></title>
    <style>
      body { font-size: 0.9em; font-family: Optima, serif; }
      .inner { background: #cfc; }
      .outer { background: #ccf; }
      .error { background: #fcc; }
      p { padding-bottom: 0; margin-top: 8px; margin-bottom: 8px; }
      p span { padding: 2px 5px; margin-left: 10px; }
    </style>
  </head>
  <body>
    <script>
      function test(expression) {
        var x = 'inner';
        document.write('<p>' + expression);
        
        try {
          var result = eval(expression);
          if (result === 'inner') {
            document.write(' <span class="inner">inner</span></p>');
          }
          else if (result === 'outer') {
            document.write(' <span class="outer">outer</span></p>');
          }
        } 
        catch(err) {
          document.write(' <span class="error">error</span></p>');
        }
      }
      
      var x = 'outer';
      
      var globalEval = (function() {

        var isIndirectEvalGlobal = (function(original, Object) {
          try {
            return (1,eval)('Object') === original;
          }
          catch(err) {
            return false;
          }
        })(Object, 123);

        if (isIndirectEvalGlobal) {
          return function(expression) {
            return (1,eval)(expression);
          };
        }
        else if (typeof window.execScript !== 'undefined') {
          return function(expression) {
            return window.execScript(expression);
          };
        }

      })();
      
      document.write('<h2>Direct calls</h2>');
      
      test("eval('x')");
      test("(eval)('x')");
      test("(((eval)))('x')");
      test("(function(){ return eval('x') })()");
      test("eval('eval(\"x\")')");
      test("(function(eval){ return eval('x'); })(eval)");
      test('with({ eval: eval }) eval("x")');
      test('with(window) eval("x")');
      
      document.write('<h2>Indirect calls:</h2>');
      
      test("(1, eval)('x')");
      test("(eval, eval)('x')");
      test("(1 ? eval : 0)('x')");
      test("(0 || eval)('x')");
      test("(__ = eval)('x')")
      test("var e = eval; e('x')");
      test("(function(e) { return e('x') })(eval)");
      test("(function(e) { return e })(eval)('x')");
      test("(function() { arguments[0]('x') })(eval)");
      test("this.eval('x')");
      test("this['eval']('x')");
      test("window.eval('x')");
      test("window.window.eval('x')");
      test("self.eval('x')");
      test("[eval][0]('x')");
      test("({ eval: eval }).eval('x')");
      test("eval.call(this, 'x')");
      test("eval.call({ }, 'x')");
      test("eval.apply(this, ['x'])");
      test("eval('eval')('x')");
      //test("Function('return eval(\"x\")')()");
      test("(eval = eval)('x')");
      test('with({ e: eval }) e("x")');
      test('var o = { eval: eval }; o.eval("x")');
      test('eval=(function(eval){return function(s){return eval(s)}})(eval); eval("x")');
      
    </script>
  </body>
</html>